<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title id="maintitle"></title>

    <!-- Input Data -->
    <script src="../DataSource/guanglun.js"></script>

    <style>
        @font-face {
            font-family: 'Kaiti';
            src: url('../../public/fonts/simkai.woff') format('woff');
        }

        body {
            font-family: 'Kaiti' !important;
        }
    </style>

    <!-- configuration parameters -->
    <meta name="defaultView" content="slideshow" />
    <meta name="controlVis" content="hidden" />
    <!-- style sheet links -->
    <link rel="stylesheet" href="../lib/ui/default/slides.css" type="text/css" media="projection" id="slideProj" />
    <link rel="stylesheet" href="../lib/ui/default/outline.css" type="text/css" media="screen" id="outlineStyle" />
    <link rel="stylesheet" href="../lib/ui/default/print.css" type="text/css" media="print" id="slidePrint" />
    <link rel="stylesheet" href="../lib/ui/default/opera.css" type="text/css" media="projection" id="operaFix" />
    <!-- <link media="screen" rel="stylesheet" href="./css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="../lib/css/common.css">
    <link media="print" rel="stylesheet" href="../lib/css/print.css">
    <!-- S5 JS -->
    <script src="../lib/ui/default/slides.js" type="text/javascript"></script>

</head>

<body>
    <div class="layout">
        <div id="controls">
            <!-- DO NOT EDIT -->
        </div>
        <div id="currentSlide">
            <!-- DO NOT EDIT -->
        </div>
        <div id="header"></div>
        <div id="footer">
            <h1></h1>
            <h2></h2>
        </div>
    </div>
    <div class="presentation">
        <div id="paragraph"></div>
    </div>
</body>


<script>
    mainData = []
    // console.log(JSON.stringify(mainData))
    // Function to dynamically load JavaScript file
    function loadScript(fileName) {
        return new Promise(function (resolve, reject) {
            const script = document.createElement('script');
            script.src = "./data/" + fileName + ".js";
            script.type = 'text/javascript';
            script.onload = function () {
                // console.log(`${fileName} has been loaded successfully.`);
                resolve(); // Resolve the promise once the script is loaded
            };
            script.onerror = function () {
                reject(new Error(`Failed to load the script: ${fileName}`));
            };
            document.body.appendChild(script);
        });
    }
    // Function to get the 'js' parameter from the URL
    function getScriptParam() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('input'); // Get the value of 'js' parameter
    }

    function getScriptParamNo() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('pageno'); // Get the value of 'pageno' parameter
    }

    // Load the JavaScript dynamically based on the URL parameter
    window.onload = async function () {
        const scriptFile = getScriptParam();
        if (scriptFile) {
            try {
                await loadScript(scriptFile); // Wait for the JS file to load
                // Log data from the dynamically loaded script after it's fully loaded
                if (typeof mainData !== 'undefined') {
                    // console.log('Data from loaded script:', JSON.stringify(mainData));
                    getPinyin(mainData);
                } else {
                    console.log('No data found in the loaded script.');
                }
            } catch (error) {
                console.error(error);
            }
        } else {
            console.log('No JS file specified.');
        }
    }

    function populateHTML(type, value, myArr) {
        let html = '';
        for (var i = 0; i < myArr.length; i++) {
            html = html + "<ruby>" + "&nbsp;" + value[i] + "&nbsp;<rt>" + myArr[i] + "</rt>" + "</ruby>"
        }
        document.getElementById(type).innerHTML = html;
    }

    function populateHTMLparagraph(type, value, myArr, index) {
        // let html = '<ruby>&nbsp;　&nbsp;<rt> </rt>&nbsp;' + index + ')&nbsp;<rt> </rt>';
        let html = '<ruby>&nbsp;　&nbsp;<rt> </rt>&nbsp; &nbsp;<rt> </rt>';

        for (var i = 0; i < myArr.length; i++) {

            if (value[i] == "< " || value[i] == "> " || value[i] == '《' || value[i] == '》' || value[i] == " ") {
                // html = html + value[i] + "&nbsp;&nbsp;" + "<rt class='symbol'></rt>"
                html = html + "<rt class='symbol'></rt>"
            } else {
                if (value[i] == "？" || value[i] == "!" || value[i] == "；" ||
                    value[i] == "," || value[i] == "." ||
                    value[i] == "，" || value[i] == "。" ||
                    value[i] == "（" || value[i] == "）" ||
                    value[i] == '“' || value[i] == '”' ||
                    value[i] == '《' || value[i] == '》' ||
                    value[i] == '「' || value[i] == '」' ||
                    value[i] == "：" ||
                    value[i] == "？" || value[i] == "！") {

                    html = html + "<dd>&nbsp;" + value[i] + "&nbsp;<rt></rt></dd>"

                    // if (value[i] == "\(") {
                    //     html = html + "<dd>&nbsp;\(&nbsp;<rt></rt></dd>"
                    // } else {
                    //     if (value[i] == "\)") {
                    //         html = html + "<dd>&nbsp;)&nbsp;<rt></rt></dd>"
                    //     } else
                    //         html = html + "<dd>&nbsp;" + value[i] + "&nbsp;<rt></rt></dd>"
                    // }

                } else {
                    html = html + "<dd>&nbsp;" + value[i] + "&nbsp;<rt>" + myArr[i] + "</rt></dd>"
                }

            }

        }
        html += "</ruby>"

        document.getElementById(type).innerHTML = html;
    }

    function getPinyin(mainDataInput) {

        let inputJSON = mainDataInput; // Load data directly from the JS file

        let maintitle = inputJSON.title
        if (inputJSON.title != "") {
            maintitle = maintitle + " " + inputJSON.subtitle
        }

        document.getElementById("maintitle").innerHTML = maintitle;

        let titlePinyin = pinyinUtil.getPinyin(inputJSON.title, ' ', true, true);
        let subtitlePinyin = pinyinUtil.getPinyin(inputJSON.subtitle, ' ', true, true);
        populateHTML("title", inputJSON.title, titlePinyin.split(" "));
        if (inputJSON.subtitle != "") {
            populateHTML("subtitle", inputJSON.subtitle, subtitlePinyin.split(" "));
        }

        let text = "";
        for (var i = 0; i < inputJSON.paragraph.length; i++) {
            let index = i + 1
            let type = "paragraph" + i
            text += `<p class="norm py-content" id="${type}"></p>`
        }
        document.getElementById("paragraph").innerHTML = text;

        for (var i = 0; i < inputJSON.paragraph.length; i++) {
            let index = i + 1
            let type = "paragraph" + i
            let paragraphTemp = inputJSON.paragraph[i].bodytext

        }


    }



</script>



</html>